<!DOCTYPE html>
<html>
<body>
    <h1>pokemon</h1>
    <p>el pokemon web</p>

    <input class="input" type="text" placeholder="ingresa nombre de pokemon">
    <button class="boton" type="submit">buscar</button>
    <button class="reiniciar">reiniciar</button>

    <div class="mensaje"></div>

    <div class="todoElContenido">

        <div class="id"></div>
        <div class="nombre"></div>
        <div class="habilidades"></div>
        <div class="tipos"></div>
        <div class="imagenes"></div>

    </div>




    <script>
        async function buscarPokemon (nombre) {
            const contenido = document.querySelector(".mensaje")

            reseteoPanel()

            try {
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${nombre}`)

                if (!response.ok) {
                    throw new Error("pokemon no encontrado, amiguito")
                }
                const data = await response.json();

                mostrarId(data)
                mostrarNombre(data)
                descripcionPokemon(data)
                habilidadesPokemon(data)
                tiposPokemon(data)
                imagenesPokemon(data)
                localizaciones(data)

                console.log("fetch general", data)
                return data

            } catch (error) {
                const mensaje = document.createElement("p")
                mensaje.textContent = "ese pokemon no existe papi"
                contenido.appendChild(mensaje)
            }
        }

        function reseteoPanel () {
            document.querySelector(".mensaje").innerHTML = ""
            document.querySelector(".id").innerHTML = ""
            document.querySelector(".nombre").innerHTML = ""
            document.querySelector(".habilidades").innerHTML = ""
            document.querySelector(".tipos").innerHTML = ""
            document.querySelector(".imagenes").innerHTML = ""
        }

        const input = document.querySelector(".input")
        const boton = document.querySelector(".boton")
        const botonReiniciar = document.querySelector(".reiniciar")

        botonReiniciar.addEventListener("click", () => {
            reseteoPanel()
        })


        boton.addEventListener("click", () => {
            const contenedorMensaje = document.querySelector(".mensaje")
            contenedorMensaje.innerHTML = ""

            if (input.value.trim() === "") {
                reseteoPanel()
                const mensaje = document.createElement("p")
                mensaje.textContent = "ingresa el nombre de un pokemon"
                contenedorMensaje.appendChild(mensaje)
                return
            } 
                const nombrePokemon = input.value.toLowerCase()
                buscarPokemon(nombrePokemon)
                input.value = ""
        })

        function mostrarNombre (data) {
            const nombreMostrado = document.querySelector(".nombre")
            nombreMostrado.innerHTML = ""

            const titulo = document.createElement("h3")
            titulo.textContent = "NOMBRE DEL POKEMON:"
            
            const parrafo = document.createElement("p")
            parrafo.textContent = data.name

            nombreMostrado.appendChild(titulo)
            nombreMostrado.appendChild(parrafo)
        }

        function mostrarId (data) {
            const idPokemon = document.querySelector(".id")
            idPokemon.innerHTML = ""

            const titulo = document.createElement("h3")
            titulo.textContent = "NUMERO DE POKEDEX:"

            const contenido = document.createElement("p")
            contenido.textContent = data.id

            idPokemon.appendChild(titulo)
            idPokemon.appendChild(contenido)
        }

        async function habilidadesPokemon(data) {
            const habilidad = document.querySelector(".habilidades")
            habilidad.innerHTML = ""

            const titulo = document.createElement("h3")
            titulo.textContent = "HABILIDADES:"
            habilidad.appendChild(titulo)

            const ul = document.createElement("ul")
            titulo.appendChild(ul)

            for(element of data.abilities) {
                const response = await fetch(element.ability.url)
                const abilityData = await response.json()
                console.log("habilidades", abilityData)

                const HabilidadEspañol = abilityData.names.find(
                    idioma => idioma.language.name === "es"
                )
                const li = document.createElement("li")
                li.textContent = HabilidadEspañol.name
                ul.appendChild(li)

                const descripcionHabilidadEspañol = abilityData.flavor_text_entries.find(
                    descripcion => descripcion.language.name === "es"
                )
                const p = document.createElement("p")
                p.textContent = descripcionHabilidadEspañol.flavor_text
                ul.appendChild(p)
            }
        }

        async function tiposPokemon (data) {
            const tipos = document.querySelector(".tipos")
            tipos.innerHTML = ""

            const titulo = document.createElement("h3")
            titulo.textContent = "TIPOS:"
            tipos.appendChild(titulo)

            const ul = document.createElement("ul")
            tipos.appendChild(ul)
            
            for(const element of data.types) {
                const response = await fetch(element.type.url)
                const tipoData = await response.json()
                console.log("tipo de dato", tipoData)

                const nombreEspañol = tipoData.names.find(
                    idioma => idioma.language.name === "es"
                )
                const li = document.createElement("li")
                li.textContent = nombreEspañol.name

                ul.appendChild(li) 
            }

        }

        async function descripcionPokemon (data) {
            const espacioAlmacen = document.querySelector(".nombre")


            const response = await fetch(data.species.url)
            const especiesData = await response.json()
            console.log("especies", especiesData)

            const descripcionNombreEspañol = especiesData.flavor_text_entries.find(
                element => element.language.name === "es",
            )
            const descripcionNombreIngles = especiesData.flavor_text_entries.find(
                elementEn => elementEn.language.name ==="en"
            )
            const p = document.createElement("p")
            p.textContent = descripcionNombreEspañol?.flavor_text || descripcionNombreIngles?.flavor_text + " (sin descripción en español)" || "de plano sin descripcion"
            espacioAlmacen.appendChild(p)
    }

        function imagenesPokemon (data) {
            const imagenes = document.querySelector(".imagenes")
            imagenes.innerHTML = ""

            const titulo = document.createElement("h3")
            titulo.textContent = "IMAGENES:"
            imagenes.appendChild(titulo)

            const imgFrente = document.createElement("img")
            imgFrente.src = data.sprites.front_default

            const imgAtras = document.createElement("img")
            imgAtras.src = data.sprites.front_shiny

            imagenes.appendChild(imgFrente)
            imagenes.appendChild(imgAtras)
        }

        async function localizaciones(data) {
            const response = await fetch(data.location_area_encounters)
            const locationData = await response.json()
            console.log("location", locationData)
        }
    </script>
</body>
</html>